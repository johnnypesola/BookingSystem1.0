(function(){angular.module("bookingSystem.menuDirective",[]).directive("mainMenu",["$route","$routeParams","$location","$rootScope",function($route,$routeParams,$location,$rootScope){return{restrict:"E",replace:true,templateUrl:"shared/directives/menuDirective.html",scope:{menuItems:"=menuItems",pageFlaps:"=?pageFlaps"},controller:["$scope","$element","$attrs",function($scope,$element,$attrs){var that=this,locationObjType,subMenuLocation,i,j,subMenu,mainMenu;$rootScope.$on("$routeChangeStart",function(event,next,current){that.selectCurrentLocationMenus()});$element.bind("mouseleave",function(event){that.disableAllButOne($scope.menuItems,"isSubMenusVisible");$scope.$digest()});that.disableAllButOne=function(menuItems,property,targetMenu){menuItems.forEach(function(menu){menu[property]=targetMenu==menu})};that.selectCurrentLocationMenus=function(){if($location.path().length>2){locationObjType=$location.path().split("/")[1];for(i=0;i<$scope.menuItems.length;i+=1){mainMenu=$scope.menuItems[i];if(typeof mainMenu.submenus!=="undefined"){for(j=0;j<mainMenu.submenus.length;j+=1){subMenu=mainMenu.submenus[j];subMenuLocation=subMenu.location.split("/")[1];if(subMenuLocation===locationObjType){that.disableAllButOne($scope.menuItems,"isMenuActive",mainMenu);$scope.pageFlaps=mainMenu.submenus;that.disableAllButOne($scope.pageFlaps,"isFlapActive",subMenu);break}}}else{subMenuLocation=mainMenu.location.split("/")[1];if(subMenuLocation===locationObjType){that.disableAllButOne($scope.menuItems,"isMenuActive",mainMenu);$scope.pageFlaps=[mainMenu];that.disableAllButOne($scope.menuItems,"isFlapActive",mainMenu);break}}}}};$scope.selectMainMenu=function(menu){$scope.selectedMainMenu=menu;that.disableAllButOne($scope.menuItems,"isMenuActive",$scope.selectedMainMenu);if(typeof menu.submenus!=="undefined"){$scope.visibleSubMenus=menu.submenus;that.disableAllButOne($scope.menuItems,"isSubMenusVisible",menu)}else{that.disableAllButOne($scope.menuItems,"isSubMenusVisible")}};$scope.selectSubMenu=function(submenu){that.disableAllButOne($scope.menuItems,"isSubMenusVisible")};that.selectCurrentLocationMenus()}]}}])})();