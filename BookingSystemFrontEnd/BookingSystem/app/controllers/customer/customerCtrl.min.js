(function(){angular.module("bookingSystem.customer",["bookingSystem.customerServices","bookingSystem.commonFilters","bookingSystem.commonDirectives"]).config(["$routeProvider",function($routeProvider){}]).controller("CustomerShowCtrl",["$scope","$routeParams","$location","$rootScope","Customer","PHOTO_MISSING_SRC","API_IMG_PATH_URL",function($scope,$routeParams,$location,$rootScope,Customer,PHOTO_MISSING_SRC,API_IMG_PATH_URL){var that=this;$scope.customer=Customer.get({customerId:$routeParams.customerId});$scope.customer.$promise.then(function(){$scope.customer.ImageSrc=$scope.customer.ImageSrc===""?PHOTO_MISSING_SRC:API_IMG_PATH_URL+$scope.customer.ImageSrc}).catch(function(){$rootScope.FlashMessage={type:"error",message:"Kunden kunde inte hämtas, var god försök igen."};$scope.customer=null})}]).controller("CustomerListCtrl",["$scope","Customer","$rootScope",function($scope,Customer,$rootScope){var customers=Customer.query();customers.$promise.catch(function(){$rootScope.FlashMessage={type:"error",message:"Kunder kunde inte hämtas, var god försök igen."}});$scope.customers=customers}]).controller("CustomerCreateCtrl",["$scope","$routeParams","$location","$rootScope","Customer","Redirect","CustomerImage",function($scope,$routeParams,$location,$rootScope,Customer,Redirect,CustomerImage){var that=this;that.uploadImage=function(CustomerId){var customerImageHttp;customerImageHttp=CustomerImage.upload($scope.customer.ImageForUpload,CustomerId);return customerImageHttp};that.saveSuccess=function(){$rootScope.FlashMessage={type:"success",message:'Kunden "'+$scope.customer.Name+'" sparades med ett lyckat resultat'};history.back()};$scope.save=function(){Customer.save({CustomerId:0,Name:$scope.customer.Name,Address:$scope.customer.Address,PostNumber:$scope.customer.PostNumber,City:$scope.customer.City,EmailAddress:$scope.customer.EmailAddress,PhoneNumber:$scope.customer.PhoneNumber,CellPhoneNumber:$scope.customer.CellPhoneNumber,ParentCustomerId:$scope.customer.ParentCustomerId,ImageSrc:$scope.customer.ImageSrc,Notes:$scope.customer.Notes}).$promise.then(function(response){if(typeof $scope.customer.ImageForUpload!=="undefined"){that.uploadImage(response.CustomerId).success(function(data){that.saveSuccess()}).error(function(){$rootScope.FlashMessage={type:"error",message:'Kunden "'+$scope.customer.Name+'" skapades, men det gick inte att ladda upp och spara den önskade bilden.'};history.back()})}else{that.saveSuccess()}}).catch(function(response){if(response.status==409){$rootScope.FlashMessage={type:"error",message:'Det finns redan en kund som heter "'+$scope.customer.Name+'". Två kunder kan inte heta lika.'}}else{$rootScope.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när kunden skulle sparas"}}})};$scope.customers=Customer.query()}]).controller("CustomerEditCtrl",["$scope","$routeParams","$location","$rootScope","Customer","CustomerImage",function($scope,$routeParams,$location,$rootScope,Customer,CustomerImage){var that=this;that.uploadImage=function(CustomerId){var customerImageHttp;customerImageHttp=CustomerImage.upload($scope.customer.ImageForUpload,CustomerId);return customerImageHttp};that.saveSuccess=function(){$rootScope.FlashMessage={type:"success",message:'Kunden "'+$scope.customer.Name+'" sparades med ett lyckat resultat'};history.back()};$scope.save=function(){Customer.save({CustomerId:$routeParams.customerId,Name:$scope.customer.Name,Address:$scope.customer.Address,PostNumber:$scope.customer.PostNumber,City:$scope.customer.City,EmailAddress:$scope.customer.EmailAddress,PhoneNumber:$scope.customer.PhoneNumber,CellPhoneNumber:$scope.customer.CellPhoneNumber,ParentCustomerId:$scope.customer.ParentCustomerId,ImageSrc:$scope.customer.ImageSrc,Notes:$scope.customer.Notes}).$promise.then(function(response){if(typeof $scope.customer.ImageForUpload!=="undefined"){that.uploadImage(response.CustomerId).success(function(){that.saveSuccess()}).error(function(){$rootScope.FlashMessage={type:"error",message:"Kunden sparades, men det gick inte att ladda upp och spara den önskade bilden."}})}else{that.saveSuccess()}}).catch(function(response){if(response.status==409){$rootScope.FlashMessage={type:"error",message:'Det finns redan en kund som heter "'+$scope.customer.Name+'". Två kunder kan inte heta lika.'}}else if(response.status==400||response.status==500){$rootScope.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när kunden skulle sparas"}}if(response.status==404){$rootScope.FlashMessage={type:"error",message:'Kunden "'+$scope.customer.Name+'" existerar inte längre. Hann kanske någon radera den?'};history.back()}})};that.customer=Customer.get({customerId:$routeParams.customerId});$scope.customers=Customer.query();that.customer.$promise.catch(function(){$rootScope.FlashMessage={type:"error",message:"Kunden kunde inte hämtas, var god försök igen."};$scope.customer=null});$scope.customer=that.customer}]).controller("CustomerDeleteCtrl",["$scope","$routeParams","Customer","$location","$rootScope",function($scope,$routeParams,Customer,$location,$rootScope){var that=this;$scope.confirm=function(){Customer.delete({customerId:$routeParams.customerId}).$promise.then(function(response){$rootScope.FlashMessage={type:"success",message:'Kunden "'+$scope.customer.Name+'" raderades med ett lyckat resultat'};history.back()}).catch(function(response){if(response.status==400&&response.data.Message!=="undefined"&&response.data.Message==="Foreign key references exists"){$rootScope.FlashMessage={type:"error",message:"Kunden kan inte raderas eftersom det finns"+" en annan kund eller ett bokningstillfälle som refererar till kunden"}}else if(response.status==400||response.status==500){$rootScope.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när kunden skulle tas bort"}}if(response.status==404){$rootScope.FlashMessage={type:"error",message:'Kunden "'+$scope.customer.Name+'" existerar inte längre. Hann kanske någon radera den?'}}history.back()})};var customer=Customer.get({customerId:$routeParams.customerId});customer.$promise.catch(function(){$rootScope.FlashMessage={type:"error",message:"Kunden kunde inte hämtas, var god försök igen."};$scope.customer=null});$scope.customer=customer}]).controller("CustomerSearchCtrl",["$scope","Customer","$rootScope",function($scope,Customer,$rootScope){var that=this;var currentDateObj;$scope.search=function(){$scope.searchResults=Customer.querySearch({column:$scope.searchColumn,value:$scope.searchValue});$scope.searchResults.$promise.then(function(){$scope.noSearchResultsFound=!$scope.searchResults.length}).catch(function(response){$rootScope.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när sökresultaten hämtades. Var god försök igen."}})};$scope.searchColumn="Name"}])})();