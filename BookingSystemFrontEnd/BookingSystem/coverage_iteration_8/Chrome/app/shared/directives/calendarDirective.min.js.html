<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for ./app/shared/directives/calendarDirective.min.js</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../../../prettify.css">
    <link rel="stylesheet" href="../../../base.css">
    <style type='text/css'>
        div.coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class="header low">
    <h1>Code coverage report for <span class="entity">./app/shared/directives/calendarDirective.min.js</span></h1>
    <h2>
        Statements: <span class="metric">7.3% <small>(10 / 137)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Branches: <span class="metric">7.27% <small>(4 / 55)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Functions: <span class="metric">17.65% <small>(6 / 34)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Lines: <span class="metric">100% <small>(1 / 1)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../index.html">All files</a> &#187; <a href="index.html">./app/shared/directives/</a> &#187; calendarDirective.min.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1</td><td class="line-coverage"><span class="cline-any cline-yes">7</span></td><td class="text"><pre class="prettyprint lang-js">(function(){angular.module("bookingSystem.calendarDirective",["bookingSystem.bookingServices","bookingSystem.locationBookingServices","bookingSystem.resourceBookingServices"]).controller("BookingCalendarInternalCtrl",["$scope","$element","$attrs","Booking","LocationBooking","ResourceBooking","$rootScope","$location","$q",<span class="fstat-no" title="function not covered" >function($scope,$element,$attrs,Booking,LocationBooking,ResourceBooking,$rootScope,$location,$q){<span class="cstat-no" title="statement not covered" ></span>var that=this,i;<span class="cstat-no" title="statement not covered" >t</span>hat.bookingType=$attrs.bookingType;<span class="cstat-no" title="statement not covered" >t</span>hat.declareBookingTypeService=<span class="fstat-no" title="function not covered" >function(){<span class="cstat-no" title="statement not covered" ></span>if(that.bookingType=="booking"){<span class="cstat-no" title="statement not covered" >that.bookingTypeService=Booking}</span>else <span class="cstat-no" title="statement not covered" >if(that.bookingType=="location-booking"){<span class="cstat-no" title="statement not covered" >that.bookingTypeService=LocationBooking}</span>else <span class="cstat-no" title="statement not covered" >if(that.bookingType=="resource-booking"){<span class="cstat-no" title="statement not covered" >that.bookingTypeService=ResourceBooking}</span>}</span></span></span>;<span class="cstat-no" title="statement not covered" >t</span>hat.updateSelectedDateIfNeeded=<span class="fstat-no" title="function not covered" >function(){<span class="cstat-no" title="statement not covered" ></span>if(typeof that.selectedMonth=="undefined"||typeof that.selectedDay=="undefined"){<span class="cstat-no" title="statement not covered" >that.selectedMonth=$location.search().manad;<span class="cstat-no" title="statement not covered" >t</span>hat.selectedDay=$location.search().dag}</span>}</span>;<span class="cstat-no" title="statement not covered" >t</span>hat.initDateVariables=<span class="fstat-no" title="function not covered" >function(){<span class="cstat-no" title="statement not covered" ></span>var yearParam=$location.search().ar;<span class="cstat-no" title="statement not covered" >v</span>ar monthParam=$location.search().manad;<span class="cstat-no" title="statement not covered" >v</span>ar dayParam=$location.search().dag||1;<span class="cstat-no" title="statement not covered" >i</span>f(typeof yearParam!=="undefined"&amp;&amp;typeof monthParam!=="undefined"){<span class="cstat-no" title="statement not covered" >that.currentDateObj=moment(yearParam+"-"+$BookSysUtil.String.addLeadingZero(monthParam)+"-"+$BookSysUtil.String.addLeadingZero(dayParam)).toDate()}</span>else{<span class="cstat-no" title="statement not covered" >that.currentDateObj=new Date;<span class="cstat-no" title="statement not covered" >t</span>hat.setDefaultUrlParams()}<span class="cstat-no" title="statement not covered" ></span>t</span>hat.updateSelectedDateIfNeeded();<span class="cstat-no" title="statement not covered" >t</span>hat.currentYear=that.currentDateObj.getFullYear();<span class="cstat-no" title="statement not covered" >t</span>hat.currentMonth=that.currentDateObj.getMonth();<span class="cstat-no" title="statement not covered" >t</span>hat.currentMonthName=moment(that.currentDateObj).format("MMMM");<span class="cstat-no" title="statement not covered" >t</span>hat.currentMonthDay=that.currentDateObj.getDate();<span class="cstat-no" title="statement not covered" >t</span>hat.currentMonthDayName=moment(that.currentDateObj).format("dddd");<span class="cstat-no" title="statement not covered" >t</span>hat.currentMonthNumberOfDays=moment(that.currentDateObj).daysInMonth();<span class="cstat-no" title="statement not covered" >t</span>hat.currentMonthStartDateObj=new Date(that.currentYear,that.currentMonth,1);<span class="cstat-no" title="statement not covered" >t</span>hat.currentMonthEndDateObj=new Date(that.currentYear,that.currentMonth,that.currentMonthNumberOfDays);<span class="cstat-no" title="statement not covered" >t</span>hat.currentMonthStartWeekDay=that.currentMonthStartDateObj.getDay()===0?7:that.currentMonthStartDateObj.getDay();<span class="cstat-no" title="statement not covered" >t</span>hat.currentMonthEndWeekDay=that.currentMonthEndDateObj.getDay()===0?7:that.currentMonthEndDateObj.getDay();<span class="cstat-no" title="statement not covered" >t</span>hat.prevMonthNumberOfDays=new Date(that.currentYear,that.currentMonth,0).getDate();<span class="cstat-no" title="statement not covered" >$</span>scope.dateHeaderString=moment(that.currentDateObj).format("dddd, Do MMMM YYYY")}</span>;<span class="cstat-no" title="statement not covered" >t</span>hat.isSelectedDay=<span class="fstat-no" title="function not covered" >function(dayNumber){<span class="cstat-no" title="statement not covered" ></span>return+that.selectedMonth===+that.currentMonth+1&amp;&amp;+that.selectedDay===dayNumber}</span>;<span class="cstat-no" title="statement not covered" >t</span>hat.dayHasBookings=<span class="fstat-no" title="function not covered" >function(dayNumber){<span class="cstat-no" title="statement not covered" ></span>if(typeof dayNumber!=="undefined"){<span class="cstat-no" title="statement not covered" >var monthNumber;<span class="cstat-no" title="statement not covered" >d</span>ayNumber=$BookSysUtil.String.addLeadingZero(dayNumber);<span class="cstat-no" title="statement not covered" >m</span>onthNumber=$BookSysUtil.String.addLeadingZero(that.currentMonth+1);<span class="cstat-no" title="statement not covered" >v</span>ar startOfDay=moment(that.currentYear+"-"+monthNumber+"-"+dayNumber+" 00:00").toDate();<span class="cstat-no" title="statement not covered" >v</span>ar endOfDay=moment(that.currentYear+"-"+monthNumber+"-"+dayNumber+" 23:59").toDate();<span class="cstat-no" title="statement not covered" >r</span>eturn that.bookingsForMonthArray.some(<span class="fstat-no" title="function not covered" >function(element){<span class="cstat-no" title="statement not covered" ></span>return element.StartTime&gt;=startOfDay&amp;&amp;element.StartTime&lt;=endOfDay||element.EndTime&gt;=startOfDay&amp;&amp;element.EndTime&lt;=endOfDay||element.StartTime&lt;startOfDay&amp;&amp;element.EndTime&gt;endOfDay}</span>)}</span>}</span>;<span class="cstat-no" title="statement not covered" >t</span>hat.prepareCalendarDays=<span class="fstat-no" title="function not covered" >function(){<span class="cstat-no" title="statement not covered" ></span>that.calendarDaysArray=[];<span class="cstat-no" title="statement not covered" >f</span>or(i=1;i&lt;that.currentMonthStartWeekDay;i++){<span class="cstat-no" title="statement not covered" >that.calendarDaysArray.push({number:that.prevMonthNumberOfDays-(that.currentMonthStartWeekDay-i-1),cssClassName:"inactive"})}<span class="cstat-no" title="statement not covered" ></span>f</span>or(i=1;i&lt;=that.currentMonthNumberOfDays;i++){<span class="cstat-no" title="statement not covered" >that.calendarDaysArray.push({number:i,cssClassName:that.isSelectedDay(i)?"active":that.dayHasBookings(i)?"has-events":""})}<span class="cstat-no" title="statement not covered" ></span>f</span>or(i=1;i&lt;=7-that.currentMonthEndWeekDay;i++){<span class="cstat-no" title="statement not covered" >that.calendarDaysArray.push({number:i,cssClassName:"inactive"})}</span>}</span>;<span class="cstat-no" title="statement not covered" >t</span>hat.getBookingsForMonth=<span class="fstat-no" title="function not covered" >function(){<span class="cstat-no" title="statement not covered" ></span>var deferred=$q.defer(),promise=deferred.promise;<span class="cstat-no" title="statement not covered" >t</span>hat.bookingsForMonthArray=that.bookingTypeService.queryLessForPeriod({fromDate:moment(that.currentMonthStartDateObj).format("YYYY-MM-DD"),toDate:moment(that.currentMonthEndDateObj).format("YYYY-MM-DD")});<span class="cstat-no" title="statement not covered" >t</span>hat.bookingsForMonthArray.$promise.catch(<span class="fstat-no" title="function not covered" >function(){<span class="cstat-no" title="statement not covered" ></span>$rootScope.FlashMessage={type:"error",message:"Bokningarna kunde inte hämtas, var god försök igen."}}</span>);<span class="cstat-no" title="statement not covered" >t</span>hat.bookingsForMonthArray.$promise.then(<span class="fstat-no" title="function not covered" >function(){<span class="cstat-no" title="statement not covered" ></span>deferred.resolve()}</span>);<span class="cstat-no" title="statement not covered" >r</span>eturn promise}</span>;<span class="cstat-no" title="statement not covered" >t</span>hat.addVarsToScope=<span class="fstat-no" title="function not covered" >function(){<span class="cstat-no" title="statement not covered" ></span>$scope.datedata={currentYear:that.currentYear,currentMonth:that.currentMonth,currentMonthName:that.currentMonthName,currentDayName:that.currentMonthDayName,currentMonthNumberOfDays:that.currentMonthNumberOfDays,calendarDays:that.calendarDaysArray}}</span>;<span class="cstat-no" title="statement not covered" >t</span>hat.setDefaultUrlParams=<span class="fstat-no" title="function not covered" >function(){<span class="cstat-no" title="statement not covered" ></span>if(typeof $location.search().ar==="undefined"&amp;&amp;typeof $location.search().manad==="undefined"&amp;&amp;typeof $location.search().dag==="undefined"){<span class="cstat-no" title="statement not covered" >$location.search("ar",moment().format("YYYY"));<span class="cstat-no" title="statement not covered" >$</span>location.search("manad",moment().format("M"));<span class="cstat-no" title="statement not covered" >$</span>location.search("dag",moment().format("D"))}</span>}</span>;<span class="cstat-no" title="statement not covered" >t</span>hat.updateCalendarContent=<span class="fstat-no" title="function not covered" >function(){<span class="cstat-no" title="statement not covered" ></span>var deferred=$q.defer(),promise=deferred.promise;<span class="cstat-no" title="statement not covered" >t</span>hat.initDateVariables();<span class="cstat-no" title="statement not covered" >t</span>hat.getBookingsForMonth().then(<span class="fstat-no" title="function not covered" >function(){<span class="cstat-no" title="statement not covered" ></span>$BookSysUtil.Date.convertStringsToDates(that.bookingsForMonthArray);<span class="cstat-no" title="statement not covered" >t</span>hat.prepareCalendarDays();<span class="cstat-no" title="statement not covered" >t</span>hat.addVarsToScope();<span class="cstat-no" title="statement not covered" >d</span>eferred.resolve()}</span>);<span class="cstat-no" title="statement not covered" >r</span>eturn promise}</span>;<span class="cstat-no" title="statement not covered" >t</span>hat.getDataForDay=<span class="fstat-no" title="function not covered" >function(){<span class="cstat-no" title="statement not covered" ></span>var bookings;<span class="cstat-no" title="statement not covered" >b</span>ookings=that.bookingTypeService.queryMoreForPeriod({fromDate:moment(that.currentDateObj).format("YYYY-MM-DD"),toDate:moment(that.currentDateObj).format("YYYY-MM-DD")});<span class="cstat-no" title="statement not covered" >b</span>ookings.$promise.catch(<span class="fstat-no" title="function not covered" >function(){<span class="cstat-no" title="statement not covered" ></span>$rootScope.FlashMessage={type:"error",message:"Bokningarna kunde inte hämtas, var god försök igen."}}</span>);<span class="cstat-no" title="statement not covered" >$</span>scope.datedata.bookings=bookings}</span>;<span class="cstat-no" title="statement not covered" >$</span>scope.changeToPreviousMonth=<span class="fstat-no" title="function not covered" >function(){<span class="cstat-no" title="statement not covered" ></span>if(that.currentMonth==0){<span class="cstat-no" title="statement not covered" >that.currentMonth=12;<span class="cstat-no" title="statement not covered" >t</span>hat.currentYear-=1}<span class="cstat-no" title="statement not covered" ></span>$</span>location.search("ar",that.currentYear);<span class="cstat-no" title="statement not covered" >$</span>location.search("manad",that.currentMonth);<span class="cstat-no" title="statement not covered" >$</span>location.search("dag",null);<span class="cstat-no" title="statement not covered" >t</span>hat.updateCalendarContent()}</span>;<span class="cstat-no" title="statement not covered" >$</span>scope.changeToNextMonth=<span class="fstat-no" title="function not covered" >function(){<span class="cstat-no" title="statement not covered" ></span>if(that.currentMonth==11){<span class="cstat-no" title="statement not covered" >that.currentYear+=1;<span class="cstat-no" title="statement not covered" >t</span>hat.currentMonth=-1}<span class="cstat-no" title="statement not covered" ></span>$</span>location.search("ar",that.currentYear);<span class="cstat-no" title="statement not covered" >$</span>location.search("manad",that.currentMonth+2);<span class="cstat-no" title="statement not covered" >$</span>location.search("dag",null);<span class="cstat-no" title="statement not covered" >t</span>hat.updateCalendarContent()}</span>;<span class="cstat-no" title="statement not covered" >$</span>scope.changeToDay=<span class="fstat-no" title="function not covered" >function($element,$attrs,event){<span class="cstat-no" title="statement not covered" ></span>var clickedDayElement=angular.element(event.target);<span class="cstat-no" title="statement not covered" >i</span>f(!clickedDayElement.hasClass("inactive")){<span class="cstat-no" title="statement not covered" >that.currentDateObj=new Date(that.currentYear,that.currentMonth,$attrs.number);<span class="cstat-no" title="statement not covered" >$</span>location.search("dag",$attrs.number);<span class="cstat-no" title="statement not covered" >t</span>hat.selectedMonth=$location.search().manad;<span class="cstat-no" title="statement not covered" >t</span>hat.selectedDay=$location.search().dag;<span class="cstat-no" title="statement not covered" >e</span>vent.preventDefault();<span class="cstat-no" title="statement not covered" >t</span>hat.initDateVariables();<span class="cstat-no" title="statement not covered" >t</span>hat.prepareCalendarDays();<span class="cstat-no" title="statement not covered" >t</span>hat.addVarsToScope();<span class="cstat-no" title="statement not covered" >t</span>hat.getDataForDay()}</span>}</span>;<span class="cstat-no" title="statement not covered" >t</span>hat.declareBookingTypeService();<span class="cstat-no" title="statement not covered" >t</span>hat.updateCalendarContent().then(<span class="fstat-no" title="function not covered" >function(){<span class="cstat-no" title="statement not covered" ></span>that.getDataForDay()}</span>)}</span>]).directive("bookingCalendar",["Booking",function(Booking){return{restrict:"E",replace:true,templateUrl:function(element,attr){<span class="missing-if-branch" title="if path not taken" >I</span>if(attr.bookingType=="booking"){<span class="cstat-no" title="statement not covered" >return"shared/directives/calendarDirectiveBooking.html"}</span>else <span class="missing-if-branch" title="if path not taken" >I</span>if(attr.bookingType=="location-booking"){<span class="cstat-no" title="statement not covered" >return"shared/directives/calendarDirectiveLocationBooking.html"}</span>else <span class="missing-if-branch" title="if path not taken" >I</span>if(attr.bookingType=="resource-booking"){<span class="cstat-no" title="statement not covered" >return"shared/directives/calendarDirectiveResourceBooking.html"}</span>},scope:true,link:<span class="fstat-no" title="function not covered" >function(){</span>},controller:"BookingCalendarInternalCtrl"}}]).directive("changeMonthButton",function(){return{restrict:"A",replace:false,scope:false,link:function(scope,element,attr){element.bind("mousedown",<span class="fstat-no" title="function not covered" >function(e){<span class="cstat-no" title="statement not covered" ></span>e.preventDefault()}</span>)},controller:["$scope","$element","$attrs",function($scope,$element,$attrs){<span class="missing-if-branch" title="else path not taken" >E</span>if($attrs.direction==="next"){$element.bind("click",<span class="fstat-no" title="function not covered" >function(){<span class="cstat-no" title="statement not covered" ></span>$scope.changeToNextMonth();<span class="cstat-no" title="statement not covered" >$</span>scope.$digest()}</span>)}else <span class="cstat-no" title="statement not covered" >if($attrs.direction==="prev"){<span class="cstat-no" title="statement not covered" >$element.bind("click",<span class="fstat-no" title="function not covered" >function(){<span class="cstat-no" title="statement not covered" ></span>$scope.changeToPreviousMonth();<span class="cstat-no" title="statement not covered" >$</span>scope.$digest()}</span>)}</span>}</span>]}}).directive("bookingCalendarDay",<span class="fstat-no" title="function not covered" >function(){<span class="cstat-no" title="statement not covered" ></span>return{restrict:"A",replace:false,scope:false,controller:["$scope","$element","$attrs",<span class="fstat-no" title="function not covered" >function($scope,$element,$attrs){<span class="cstat-no" title="statement not covered" ></span>$element.bind("click",<span class="fstat-no" title="function not covered" >function(event){<span class="cstat-no" title="statement not covered" ></span>$scope.changeToDay($element,$attrs,event)}</span>)}</span>]}}</span>)})();</pre></td></tr>
</table></pre>

</div>
<div class="footer">
    <div class="meta">Generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sun May 31 2015 21:26:57 GMT+0200 (Västeuropa, sommartid)</div>
</div>
<script src="../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../sorter.js"></script>
</body>
</html>
